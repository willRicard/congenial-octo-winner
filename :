# -*- coding: utf-8 -*-
""" Affichage tête-haute """

import curses

from gettext import gettext

# @enum Couleur de fond pour un champ
COLOR_RED = 1
COLOR_BLUE = 2
COLOR_YELLOW = 3

# @enum Type de champ
FIELD_TYPE_NUMBER = 0  # un nombre
FIELD_TYPE_QUOTIENT = 1  # un quotient: nombre/nombre

NUMBER_FIELD_LENGTH = 3  # 3 chiffres max
QUOTIENT_FIELD_LENGTH = 7  # 2*3 chiffres max + 1 slash

ITH_FIELDS = [("❤︎ Vie", FIELD_TYPE_QUOTIENT, COLOR_RED),
              ("* Mana", FIELD_TYPE_QUOTIENT, COLOR_BLUE),
              ("$ Or", FIELD_TYPE_NUMBER, COLOR_YELLOW)]


class ITH:
    """ Affichage tête haute """
    def __init__(self):
        """ Précalcul des positions où afficher les champs """
        self.win = curses.newwin(1, curses.COLS, curses.LINES - 1, 0)
        self.cols = []

        col = 0
        for label, field_type, color in ITH_FIELDS:
            # on écrit le nom du champ
            self.win.addstr(0, col, gettext(label),
                            curses.color_pair(color) | curses.A_BOLD)
            # on décale le curseur
            col += len(gettext(label))
            self.cols.append(col)

            # on laisse la place pour
            # remplir le champ
            if field_type == FIELD_TYPE_QUOTIENT:
                col += QUOTIENT_FIELD_LENGTH
            elif field_type == FIELD_TYPE_NUMBER:
                col += NUMBER_FIELD_LENGTH

    def refresh(self, joueur):
        """ Rafraîchit l'affichage de l'ITH """
        champs = [
            str(joueur.vie) + '/' + str(joueur.max_vie),
            str(joueur.mana) + '/' + str(joueur.max_mana),
            str(joueur.gold)
        ]

        for i, (_, field_type, color) in enumerate(ITH_FIELDS):
            if field_type == FIELD_TYPE_QUOTIENT and len(
                    champs[i]) < QUOTIENT_FIELD_LENGTH:
                champs[i].prepend(" ")
            self.win.addstr(0, self.cols[i], champs[i],
                            curses.color_pair(i + 1) | curses.A_BOLD)

        self.win.refresh()
